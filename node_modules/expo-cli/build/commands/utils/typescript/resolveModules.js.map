{"version":3,"sources":["../../../../src/commands/utils/typescript/resolveModules.ts"],"names":["requiredPackages","file","pkg","baseTSConfigName","queryFirstProjectTypeScriptFileAsync","projectRoot","Promise","resolve","reject","mg","Glob","cwd","ignore","error","matches","once","matched","abort","resolveBaseTSConfig","resolveFrom","silent","hasTSConfig","tsConfigPath","path","join","collectMissingPackages","resolutions","missingPackages","filter","p","missing"],"mappings":";;;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;;;;;AAEA,MAAMA,gBAAgB,GAAG,CACvB;AACA;AACA;AAAEC,EAAAA,IAAI,EAAE,yBAAR;AAAmCC,EAAAA,GAAG,EAAE;AAAxC,CAHuB,EAIvB;AAAED,EAAAA,IAAI,EAAE,yBAAR;AAAmCC,EAAAA,GAAG,EAAE;AAAxC,CAJuB,EAKvB;AAAED,EAAAA,IAAI,EAAE,gCAAR;AAA0CC,EAAAA,GAAG,EAAE;AAA/C,CALuB,CAAzB;AAQO,MAAMC,gBAAgB,GAAG,oBAAzB;;;AAEA,SAASC,oCAAT,CAA8CC,WAA9C,EAA2F;AAChG;AACA,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,EAAE,GAAG,KAAIC,YAAJ,EACT,eADS,EAET;AACEC,MAAAA,GAAG,EAAEN,WADP;AAEEO,MAAAA,MAAM,EAAE,CAAC,qCAAD,EAAwC,WAAxC,EAAqD,mBAArD;AAFV,KAFS,EAMT,CAACC,KAAD,EAAQC,OAAR,KAAoB;AAClB,UAAID,KAAJ,EAAW;AACTL,QAAAA,MAAM,CAACK,KAAD,CAAN;AACD,OAFD,MAEO;AAAA;;AACLN,QAAAA,OAAO,cAACO,OAAO,CAAC,CAAD,CAAR,iDAAe,IAAf,CAAP;AACD;AACF,KAZQ,CAAX;AAcAL,IAAAA,EAAE,CAACM,IAAH,CAAQ,OAAR,EAAiBC,OAAO,IAAI;AAC1BP,MAAAA,EAAE,CAACQ,KAAH;AACAV,MAAAA,OAAO,CAACS,OAAD,CAAP;AACD,KAHD;AAID,GAnBM,CAAP;AAoBD;;AAEM,SAASE,mBAAT,CAA6Bb,WAA7B,EAAiE;AAAA;;AACtE,gCAAOc,uBAAYC,MAAZ,CAAmBf,WAAnB,EAAgC,yBAAhC,CAAP,qEAAqE,IAArE;AACD;;AAEM,eAAegB,WAAf,CAA2BhB,WAA3B,EAAwE;AAC7E,QAAMiB,YAAY,GAAGC,IAAI,GAACC,IAAL,CAAUnB,WAAV,EAAuB,eAAvB,CAArB;;AACA,MAAI,MAAM,+BAAgBiB,YAAhB,CAAV,EAAyC;AACvC,WAAOA,YAAP;AACD;;AACD,SAAO,IAAP;AACD;;AAEM,SAASG,sBAAT,CACLpB,WADK,EASL;AACA,QAAMqB,WAAmC,GAAG,EAA5C;AAEA,QAAMC,eAAe,GAAG3B,gBAAgB,CAAC4B,MAAjB,CAAwBC,CAAC,IAAI;AACnD,QAAI;AACFH,MAAAA,WAAW,CAACG,CAAC,CAAC3B,GAAH,CAAX,GAAqB,4BAAYG,WAAZ,EAAyBwB,CAAC,CAAC5B,IAA3B,CAArB;AACA,aAAO,KAAP;AACD,KAHD,CAGE,gBAAM;AACN,aAAO,IAAP;AACD;AACF,GAPuB,CAAxB;AASA,SAAO;AAAE6B,IAAAA,OAAO,EAAEH,eAAX;AAA4BD,IAAAA;AAA5B,GAAP;AACD","sourcesContent":["import { fileExistsAsync } from '@expo/config';\nimport { Glob } from 'glob';\nimport * as path from 'path';\nimport resolveFrom from 'resolve-from';\n\nconst requiredPackages = [\n  // use typescript/package.json to skip node module cache issues when the user installs\n  // the package and attempts to resolve the module in the same process.\n  { file: 'typescript/package.json', pkg: 'typescript' },\n  { file: '@types/react/index.d.ts', pkg: '@types/react' },\n  { file: '@types/react-native/index.d.ts', pkg: '@types/react-native' },\n];\n\nexport const baseTSConfigName = 'expo/tsconfig.base';\n\nexport function queryFirstProjectTypeScriptFileAsync(projectRoot: string): Promise<null | string> {\n  // Bail out as soon as a single match is found.\n  return new Promise((resolve, reject) => {\n    const mg = new Glob(\n      '**/*.{ts,tsx}',\n      {\n        cwd: projectRoot,\n        ignore: ['**/@(Carthage|Pods|node_modules)/**', '**/*.d.ts', '/{ios,android}/**'],\n      },\n      (error, matches) => {\n        if (error) {\n          reject(error);\n        } else {\n          resolve(matches[0] ?? null);\n        }\n      }\n    );\n    mg.once('match', matched => {\n      mg.abort();\n      resolve(matched);\n    });\n  });\n}\n\nexport function resolveBaseTSConfig(projectRoot: string): string | null {\n  return resolveFrom.silent(projectRoot, 'expo/tsconfig.base.json') ?? null;\n}\n\nexport async function hasTSConfig(projectRoot: string): Promise<string | null> {\n  const tsConfigPath = path.join(projectRoot, 'tsconfig.json');\n  if (await fileExistsAsync(tsConfigPath)) {\n    return tsConfigPath;\n  }\n  return null;\n}\n\nexport function collectMissingPackages(\n  projectRoot: string\n): {\n  missing: {\n    file: string;\n    pkg: string;\n    version?: string;\n  }[];\n  resolutions: Record<string, string>;\n} {\n  const resolutions: Record<string, string> = {};\n\n  const missingPackages = requiredPackages.filter(p => {\n    try {\n      resolutions[p.pkg] = resolveFrom(projectRoot, p.file);\n      return false;\n    } catch {\n      return true;\n    }\n  });\n\n  return { missing: missingPackages, resolutions };\n}\n"],"file":"resolveModules.js"}