{"version":3,"sources":["detach/IosPodsTools.js"],"names":["_validatePodfileSubstitutions","substitutions","validKeys","key","hasOwnProperty","includes","Error","_renderExpoKitDependency","options","sdkVersion","sdkMajorVersion","parseSdkMajorVersion","let","attributes","expoKitPath","path","join","expoKitTag","git","tag","branch","subspecs","process","env","EXPO_UNIVERSE_DIR","inhibit_warnings","dependency","indentString","_renderDependencyAttributes","_renderUnversionedReactNativeDependency","glogLibraryName","_renderUnversionedReactDependency","_renderUnversionedYogaDependency","_renderUnversionedThirdPartyDependency","reactNativePath","podName","podspecRelativePath","podspec","attributesStrings","Object","keys","value","JSON","stringify","push","createSdkFilterFn","String","toUpperCase","undefined","match","sdkVersionWithUnderscores","replace","i","endsWith","async","_renderVersionedReactNativeDependenciesAsync","templatesDirectory","versionedReactNativePath","expoSubspecs","shellAppSdkVersion","filterFn","result","await","_concatTemplateFilesInDirectoryAsync","map","subspec","_renderVersionedReactNativePostinstallsAsync","directory","templateFilenames","globSync","absolute","cwd","sort","filteredTemplateFilenames","filter","templateStrings","fileIdx","nFiles","length","filename","templateString","fs","readFile","_renderDetachedPostinstall","isServiceContext","podNameExpression","targetExpression","podsRootSub","maybeDetachedServiceDef","maybeFrameworkSearchPathDef","excludeIdfaCodeFromBranchSinceSDK39","_renderUnversionedPostinstall","podsToChangeDeployTarget","podsToChangeRB","pod","deploymentTarget","podsToChangeDeployTargetIfStart","podsToChangeDeployTargetIfEnd","gccPreprocessorDefinitionsCondition","_renderTestTarget","_renderPodDependenciesAsync","dependenciesConfigPath","dependencies","JsonFile","readAsync","type","isPodfile","noWarningsFlag","depsStrings","builder","comments","commentLine","otherPodfileFlags","name","version","renderExpoKitPodspecAsync","pathToTemplate","pathToOutput","moreSubstitutions","dirname","IOS_EXPONENT_CLIENT_VERSION","writeFile","_renderUnversionedUniversalModulesDependencies","universalModules","universalModulesPath","excludedUnimodules","expoModulesThatAreNotUnimodules","module","moduleInfo","_renderUnversionedUniversalModuleDependency","renderPodfileAsync","REACT_NATIVE_PATH","rnDependencyOptions","EXPOKIT_PATH","EXPOKIT_TAG","expoKitDependencyOptions","versionedRnPath","VERSIONED_REACT_NATIVE_PATH","rnExpoSubspecs","REACT_NATIVE_EXPO_SUBSPECS","versionedDependencies","versionedPostinstalls","podDependencies","UNIVERSAL_MODULES","EXPONENT_CLIENT_DEPS","EXPOKIT_DEPENDENCY","PODFILE_UNVERSIONED_EXPO_MODULES_DEPENDENCIES","UNIVERSAL_MODULES_PATH","PODFILE_UNVERSIONED_RN_DEPENDENCY","PODFILE_UNVERSIONED_POSTINSTALL","PODFILE_DETACHED_POSTINSTALL","PODFILE_DETACHED_SERVICE_POSTINSTALL","PODFILE_VERSIONED_RN_DEPENDENCIES","PODFILE_VERSIONED_POSTINSTALLS","PODFILE_TEST_TARGET","replacement","RegExp"],"mappings":"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","file":"../../detach/IosPodsTools.js","sourcesContent":["import JsonFile from '@expo/json-file';\nimport fs from 'fs-extra';\nimport { sync as globSync } from 'glob';\nimport indentString from 'indent-string';\nimport path from 'path';\n\nimport { parseSdkMajorVersion } from './ExponentTools';\n\nfunction _validatePodfileSubstitutions(substitutions) {\n  const validKeys = [\n    // a pod dependency on ExpoKit (can be local or remote)\n    'EXPOKIT_DEPENDENCY',\n    // local path to ExpoKit dependency\n    'EXPOKIT_PATH',\n    // tag to use for ExpoKit dependency\n    'EXPOKIT_TAG',\n    // the contents of dependencies.json enumerated as deps in podfile format\n    'EXPONENT_CLIENT_DEPS',\n    // postinstall for detached projects (defines EX_DETACHED among other things)\n    'PODFILE_DETACHED_POSTINSTALL',\n    // same as previous but also defines EX_DETACHED_SERVICE\n    'PODFILE_DETACHED_SERVICE_POSTINSTALL',\n    // ExponentIntegrationTests\n    'PODFILE_TEST_TARGET',\n    // unversioned react native pod dependency, probably at the path given in\n    // REACT_NATIVE_PATH, with a bunch of subspecs.\n    'PODFILE_UNVERSIONED_RN_DEPENDENCY',\n    // postinstall hook for unversioned deps\n    'PODFILE_UNVERSIONED_POSTINSTALL',\n    // versioned rn dependencies (paths to versioned-react-native directories)\n    // read from template files\n    'PODFILE_VERSIONED_RN_DEPENDENCIES',\n    // versioned rn postinstall hooks read from template files\n    'PODFILE_VERSIONED_POSTINSTALLS',\n    // list of generated Expo subspecs to include under a versioned react native dependency\n    'REACT_NATIVE_EXPO_SUBSPECS',\n    // path to use for the unversioned react native dependency\n    'REACT_NATIVE_PATH',\n    // name of the main build target, e.g. Exponent\n    'TARGET_NAME',\n    // path from Podfile to versioned-react-native\n    'VERSIONED_REACT_NATIVE_PATH',\n    // Expo universal modules dependencies\n    'PODFILE_UNVERSIONED_EXPO_MODULES_DEPENDENCIES',\n    // Universal modules configurations to be included in the Podfile\n    'UNIVERSAL_MODULES',\n    // Relative path from iOS project directory to folder where unimodules are installed.\n    'UNIVERSAL_MODULES_PATH',\n  ];\n\n  for (const key in substitutions) {\n    if (substitutions.hasOwnProperty(key)) {\n      if (!validKeys.includes(key)) {\n        throw new Error(`Unrecognized Podfile template key: ${key}`);\n      }\n    }\n  }\n  return true;\n}\n\nfunction _renderExpoKitDependency(options, sdkVersion) {\n  const sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n  let attributes;\n  if (options.expoKitPath) {\n    attributes = {\n      path: path.join(options.expoKitPath, 'ios'),\n    };\n  } else if (options.expoKitTag) {\n    attributes = {\n      git: 'http://github.com/expo/expo.git',\n      tag: options.expoKitTag,\n    };\n  } else {\n    attributes = {\n      git: 'http://github.com/expo/expo.git',\n      branch: 'master',\n    };\n  }\n\n  // GL subspec is available as of SDK 26\n  // but removed together with CPP subspec in SDK 29\n  if (sdkMajorVersion < 26) {\n    attributes.subspecs = ['Core', 'CPP'];\n  } else if (sdkMajorVersion < 29 && !process.env.EXPO_UNIVERSE_DIR) {\n    attributes.subspecs = ['Core', 'CPP', 'GL'];\n  } else {\n    attributes.subspecs = ['Core'];\n  }\n  attributes.inhibit_warnings = true;\n\n  const dependency = `pod 'ExpoKit',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n\n  return indentString(dependency, 2);\n}\n\n/**\n * @param sdkVersion if specified, indicates which sdkVersion this project uses\n *  as 'UNVERSIONED', e.g. if we are detaching a sdk15 project, we render\n *  an unversioned dependency pointing at RN#sdk-15.\n */\nfunction _renderUnversionedReactNativeDependency(options, sdkVersion) {\n  const sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n\n  if (sdkMajorVersion >= 39) {\n    return indentString(`\n# Install React Native and its dependencies\nrequire_relative '../node_modules/react-native/scripts/react_native_pods'\nuse_react_native!(production: true)`);\n  }\n\n  if (sdkMajorVersion >= 36) {\n    return indentString(\n      `\n# Install React Native and its dependencies\nrequire_relative '../node_modules/react-native/scripts/autolink-ios.rb'\nuse_react_native!`\n    );\n  }\n\n  const glogLibraryName = sdkMajorVersion < 26 ? 'GLog' : 'glog';\n  return indentString(\n    `\n${_renderUnversionedReactDependency(options)}\n${_renderUnversionedYogaDependency(options)}\n${_renderUnversionedThirdPartyDependency(\n  'DoubleConversion',\n  path.join('third-party-podspecs', 'DoubleConversion.podspec'),\n  options\n)}\n${_renderUnversionedThirdPartyDependency(\n  'Folly',\n  path.join('third-party-podspecs', 'Folly.podspec'),\n  options\n)}\n${_renderUnversionedThirdPartyDependency(\n  glogLibraryName,\n  path.join('third-party-podspecs', `${glogLibraryName}.podspec`),\n  options\n)}\n`,\n    2\n  );\n}\n\nfunction _renderUnversionedReactDependency(options, sdkVersion) {\n  if (!options.reactNativePath) {\n    throw new Error(`Unsupported options for RN dependency: ${options}`);\n  }\n  const attributes = {\n    path: options.reactNativePath,\n    inhibit_warnings: true,\n    subspecs: [\n      'Core',\n      'ART',\n      'RCTActionSheet',\n      'RCTAnimation',\n      'RCTCameraRoll',\n      'RCTGeolocation',\n      'RCTImage',\n      'RCTNetwork',\n      'RCTText',\n      'RCTVibration',\n      'RCTWebSocket',\n      'DevSupport',\n      'CxxBridge',\n    ],\n  };\n  return `pod 'React',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n}\n\nfunction _renderUnversionedYogaDependency(options) {\n  let attributes;\n  if (options.reactNativePath) {\n    attributes = {\n      path: path.join(options.reactNativePath, 'ReactCommon', 'yoga'),\n      inhibit_warnings: true,\n    };\n  } else {\n    throw new Error(`Unsupported options for Yoga dependency: ${options}`);\n  }\n  return `pod 'yoga',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n}\n\nfunction _renderUnversionedThirdPartyDependency(podName, podspecRelativePath, options) {\n  let attributes;\n  if (options.reactNativePath) {\n    attributes = {\n      podspec: path.join(options.reactNativePath, podspecRelativePath),\n      inhibit_warnings: true,\n    };\n  } else {\n    throw new Error(`Unsupported options for ${podName} dependency: ${options}`);\n  }\n  return `pod '${podName}',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n}\n\nfunction _renderDependencyAttributes(attributes) {\n  const attributesStrings = [];\n  for (const key of Object.keys(attributes)) {\n    const value = JSON.stringify(attributes[key], null, 2);\n    attributesStrings.push(`:${key} => ${value}`);\n  }\n  return attributesStrings.join(',\\n');\n}\n\nfunction createSdkFilterFn(sdkVersion) {\n  if (sdkVersion && String(sdkVersion).toUpperCase() === 'UNVERSIONED') {\n    return () => false;\n  }\n  if (sdkVersion === undefined || !sdkVersion.match(/^\\d+\\.\\d+.\\d+$/)) {\n    return;\n  }\n  const sdkVersionWithUnderscores = sdkVersion.replace(/\\./g, '_');\n  return i => i.endsWith(`/ReactABI${sdkVersionWithUnderscores}.rb`);\n}\n\nasync function _renderVersionedReactNativeDependenciesAsync(\n  templatesDirectory,\n  versionedReactNativePath,\n  expoSubspecs,\n  shellAppSdkVersion\n) {\n  const filterFn = createSdkFilterFn(shellAppSdkVersion);\n  let result = await _concatTemplateFilesInDirectoryAsync(\n    path.join(templatesDirectory, 'versioned-react-native', 'dependencies'),\n    filterFn\n  );\n  expoSubspecs = expoSubspecs.map(subspec => `'${subspec}'`).join(', ');\n  result = result.replace(/\\$\\{VERSIONED_REACT_NATIVE_PATH\\}/g, versionedReactNativePath);\n  result = result.replace(/\\$\\{REACT_NATIVE_EXPO_SUBSPECS\\}/g, expoSubspecs);\n  return result;\n}\n\nasync function _renderVersionedReactNativePostinstallsAsync(\n  templatesDirectory,\n  shellAppSdkVersion\n) {\n  const filterFn = createSdkFilterFn(shellAppSdkVersion);\n  return _concatTemplateFilesInDirectoryAsync(\n    path.join(templatesDirectory, 'versioned-react-native', 'postinstalls'),\n    filterFn\n  );\n}\n\nasync function _concatTemplateFilesInDirectoryAsync(directory, filterFn) {\n  const templateFilenames = globSync('*.rb', { absolute: true, cwd: directory }).sort();\n  const filteredTemplateFilenames = filterFn\n    ? templateFilenames.filter(filterFn)\n    : templateFilenames;\n  const templateStrings = [];\n  // perform this in series in order to get deterministic output\n  for (let fileIdx = 0, nFiles = filteredTemplateFilenames.length; fileIdx < nFiles; fileIdx++) {\n    const filename = filteredTemplateFilenames[fileIdx];\n    const templateString = await fs.readFile(filename, 'utf8');\n    if (templateString) {\n      templateStrings.push(templateString);\n    }\n  }\n  return templateStrings.join('\\n');\n}\n\nfunction _renderDetachedPostinstall(sdkVersion, isServiceContext) {\n  const sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n  const podNameExpression = sdkMajorVersion < 33 ? 'target.pod_name' : 'pod_name';\n  const targetExpression = sdkMajorVersion < 33 ? 'target' : 'target_installation_result';\n\n  const podsRootSub = '${PODS_ROOT}';\n  const maybeDetachedServiceDef = isServiceContext\n    ? `config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'EX_DETACHED_SERVICE=1'`\n    : '';\n\n  const maybeFrameworkSearchPathDef =\n    sdkMajorVersion < 33\n      ? `\n          # Needed for GoogleMaps 2.x\n          config.build_settings['FRAMEWORK_SEARCH_PATHS'] ||= []\n          config.build_settings['FRAMEWORK_SEARCH_PATHS'] << '${podsRootSub}/GoogleMaps/Base/Frameworks'\n          config.build_settings['FRAMEWORK_SEARCH_PATHS'] << '${podsRootSub}/GoogleMaps/Maps/Frameworks'`\n      : '';\n  // In SDK39, in preparation for iOS 14 we've decided to remove IDFA code.\n  // By adding this macro to shell apps we'll remove this code from Branch\n  // on compilation level, see:\n  // https://github.com/BranchMetrics/ios-branch-deep-linking-attribution/blob/ac991f9d0bc9bad640b25a0f1192679a8cfa083a/Branch-SDK/BNCSystemObserver.m#L49-L75\n  const excludeIdfaCodeFromBranchSinceSDK39 =\n    sdkMajorVersion >= 39\n      ? `\n      if ${podNameExpression} == 'Branch'\n        ${targetExpression}.native_target.build_configurations.each do |config|\n          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= ['$(inherited)']\n          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'BRANCH_EXCLUDE_IDFA_CODE=1'\n        end\n      end`\n      : '';\n  return `\n      if ${podNameExpression} == 'ExpoKit'\n        ${targetExpression}.native_target.build_configurations.each do |config|\n          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= ['$(inherited)']\n          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'EX_DETACHED=1'\n          ${maybeDetachedServiceDef}\n          # Enable Google Maps support\n          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'HAVE_GOOGLE_MAPS=1'\n          config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'HAVE_GOOGLE_MAPS_UTILS=1'\n          ${maybeFrameworkSearchPathDef}\n        end\n      end\n\n      ${excludeIdfaCodeFromBranchSinceSDK39}\n`;\n}\n\nfunction _renderUnversionedPostinstall(sdkVersion) {\n  const podsToChangeDeployTarget = [\n    'Amplitude-iOS',\n    'Analytics',\n    'AppAuth',\n    'Branch',\n    'CocoaLumberjack',\n    'FBSDKCoreKit',\n    'FBSDKLoginKit',\n    'FBSDKShareKit',\n    'GPUImage',\n    'JKBigInteger2',\n  ];\n  const podsToChangeRB = `[${podsToChangeDeployTarget.map(pod => `'${pod}'`).join(',')}]`;\n  const sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n  const podNameExpression = sdkMajorVersion < 33 ? 'target.pod_name' : 'pod_name';\n  const targetExpression = sdkMajorVersion < 33 ? 'target' : 'target_installation_result';\n\n  // SDK41 drops support for iOS 10.0\n  const deploymentTarget = sdkMajorVersion > 40 ? '11.0' : '10.0';\n\n  const podsToChangeDeployTargetIfStart =\n    sdkMajorVersion <= 33 ? `      if ${podsToChangeRB}.include? ${podNameExpression}` : '';\n  const podsToChangeDeployTargetIfEnd = sdkMajorVersion <= 33 ? '      end' : '';\n  const gccPreprocessorDefinitionsCondition =\n    sdkMajorVersion < 36\n      ? `${podNameExpression} == 'React'`\n      : `${podNameExpression}.start_with?('React')`;\n\n  return `\n${podsToChangeDeployTargetIfStart}\n      ${targetExpression}.native_target.build_configurations.each do |config|\n        config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '${deploymentTarget}'\n      end\n${podsToChangeDeployTargetIfEnd}\n\n      # Can't specify this in the React podspec because we need to use those podspecs for detached\n      # projects which don't reference ExponentCPP.\n      if ${podNameExpression}.start_with?('React')\n        ${targetExpression}.native_target.build_configurations.each do |config|\n          config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '${deploymentTarget}'\n          config.build_settings['HEADER_SEARCH_PATHS'] ||= ['$(inherited)']\n        end\n      end\n\n      # Build React Native with RCT_DEV enabled and RCT_ENABLE_INSPECTOR and\n      # RCT_ENABLE_PACKAGER_CONNECTION disabled\n      next unless ${gccPreprocessorDefinitionsCondition}\n      ${targetExpression}.native_target.build_configurations.each do |config|\n        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= ['$(inherited)']\n        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'RCT_DEV=1'\n        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'RCT_ENABLE_INSPECTOR=0'\n        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'ENABLE_PACKAGER_CONNECTION=0'\n      end\n`;\n}\n\nfunction _renderTestTarget(reactNativePath) {\n  return `\n  target 'ExponentIntegrationTests' do\n    inherit! :search_paths\n  end\n\n  target 'Tests' do\n    inherit! :search_paths\n  end\n`;\n}\n\nasync function _renderPodDependenciesAsync(dependenciesConfigPath, options) {\n  const dependencies = await new JsonFile(dependenciesConfigPath).readAsync();\n  const type = options.isPodfile ? 'pod' : 'ss.dependency';\n  const noWarningsFlag = options.isPodfile ? `, :inhibit_warnings => true` : '';\n  const depsStrings = dependencies.map(dependency => {\n    let builder = '';\n    if (dependency.comments) {\n      builder += dependency.comments.map(commentLine => `  # ${commentLine}`).join('\\n');\n      builder += '\\n';\n    }\n    const otherPodfileFlags = options.isPodfile && dependency.otherPodfileFlags;\n    builder += `  ${type} '${dependency.name}', '${dependency.version}'${noWarningsFlag}${\n      otherPodfileFlags || ''\n    }`;\n    return builder;\n  });\n  return depsStrings.join('\\n');\n}\n\nasync function renderExpoKitPodspecAsync(pathToTemplate, pathToOutput, moreSubstitutions) {\n  const templatesDirectory = path.dirname(pathToTemplate);\n  const templateString = await fs.readFile(pathToTemplate, 'utf8');\n  const dependencies = await _renderPodDependenciesAsync(\n    path.join(templatesDirectory, 'dependencies.json'),\n    { isPodfile: false }\n  );\n  let result = templateString.replace(/\\$\\{IOS_EXPOKIT_DEPS\\}/g, indentString(dependencies, 2));\n  if (moreSubstitutions && moreSubstitutions.IOS_EXPONENT_CLIENT_VERSION) {\n    result = result.replace(\n      /\\$\\{IOS_EXPONENT_CLIENT_VERSION\\}/g,\n      moreSubstitutions.IOS_EXPONENT_CLIENT_VERSION\n    );\n  }\n\n  await fs.writeFile(pathToOutput, result);\n}\n\nfunction _renderUnversionedUniversalModulesDependencies(\n  universalModules,\n  universalModulesPath,\n  sdkVersion\n) {\n  const sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n\n  if (sdkMajorVersion >= 33) {\n    const excludedUnimodules = [\n      'expo-bluetooth',\n      'expo-in-app-purchases',\n      'expo-payments-stripe',\n      'expo-module-template',\n      'expo-image',\n    ];\n\n    if (sdkMajorVersion < 39) {\n      excludedUnimodules.push('expo-splash-screen', 'expo-updates');\n    }\n\n    const expoModulesThatAreNotUnimodules = [];\n    if (sdkMajorVersion >= 39) {\n      expoModulesThatAreNotUnimodules.push(\n        `pod 'EXRandom', path: '${universalModulesPath}/expo-random/ios'`\n      );\n    }\n\n    return indentString(\n      `\n# Install unimodules\nrequire_relative '../node_modules/react-native-unimodules/cocoapods.rb'\nuse_unimodules!(\n  modules_paths: ['${universalModulesPath}'],\n  exclude: [\n    ${excludedUnimodules.map(module => `'${module}'`).join(',\\n    ')}\n  ],\n)\n\n# Expo modules that are not unimodules\n${expoModulesThatAreNotUnimodules.join('\\n')}\n`,\n      2\n    );\n  } else {\n    return indentString(\n      universalModules\n        .map(moduleInfo =>\n          _renderUnversionedUniversalModuleDependency(\n            moduleInfo.podName,\n            moduleInfo.path,\n            sdkVersion\n          )\n        )\n        .join('\\n'),\n      2\n    );\n  }\n}\n\nfunction _renderUnversionedUniversalModuleDependency(podName, path, sdkVersion) {\n  const attributes = {\n    path,\n  };\n  return `pod '${podName}',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n}\n\n/**\n *  @param pathToTemplate path to template Podfile\n *  @param pathToOutput path to render final Podfile\n *  @param moreSubstitutions dictionary of additional substitution keys and values to replace\n *         in the template, such as: TARGET_NAME, REACT_NATIVE_PATH\n */\nasync function renderPodfileAsync(\n  pathToTemplate,\n  pathToOutput,\n  moreSubstitutions,\n  shellAppSdkVersion,\n  sdkVersion = 'UNVERSIONED'\n) {\n  if (!moreSubstitutions) {\n    moreSubstitutions = {};\n  }\n  const templatesDirectory = path.dirname(pathToTemplate);\n  const templateString = await fs.readFile(pathToTemplate, 'utf8');\n\n  const reactNativePath = moreSubstitutions.REACT_NATIVE_PATH;\n  let rnDependencyOptions;\n  if (reactNativePath) {\n    rnDependencyOptions = { reactNativePath };\n  } else {\n    rnDependencyOptions = {};\n  }\n\n  const expoKitPath = moreSubstitutions.EXPOKIT_PATH;\n  const expoKitTag = moreSubstitutions.EXPOKIT_TAG;\n  let expoKitDependencyOptions = {};\n  if (expoKitPath) {\n    expoKitDependencyOptions = { expoKitPath };\n  } else if (expoKitTag) {\n    expoKitDependencyOptions = { expoKitTag };\n  }\n\n  let versionedRnPath = moreSubstitutions.VERSIONED_REACT_NATIVE_PATH;\n  if (!versionedRnPath) {\n    versionedRnPath = './versioned-react-native';\n  }\n  let rnExpoSubspecs = moreSubstitutions.REACT_NATIVE_EXPO_SUBSPECS;\n  if (!rnExpoSubspecs) {\n    rnExpoSubspecs = ['Expo'];\n  }\n\n  const versionedDependencies = await _renderVersionedReactNativeDependenciesAsync(\n    templatesDirectory,\n    versionedRnPath,\n    rnExpoSubspecs,\n    shellAppSdkVersion\n  );\n  const versionedPostinstalls = await _renderVersionedReactNativePostinstallsAsync(\n    templatesDirectory,\n    shellAppSdkVersion\n  );\n  const podDependencies = await _renderPodDependenciesAsync(\n    path.join(templatesDirectory, 'dependencies.json'),\n    { isPodfile: true }\n  );\n\n  let universalModules = moreSubstitutions.UNIVERSAL_MODULES;\n  if (!universalModules) {\n    universalModules = [];\n  }\n\n  const substitutions = {\n    EXPONENT_CLIENT_DEPS: podDependencies,\n    EXPOKIT_DEPENDENCY: _renderExpoKitDependency(expoKitDependencyOptions, sdkVersion),\n    PODFILE_UNVERSIONED_EXPO_MODULES_DEPENDENCIES: _renderUnversionedUniversalModulesDependencies(\n      universalModules,\n      moreSubstitutions.UNIVERSAL_MODULES_PATH,\n      sdkVersion\n    ),\n    PODFILE_UNVERSIONED_RN_DEPENDENCY: _renderUnversionedReactNativeDependency(\n      rnDependencyOptions,\n      sdkVersion\n    ),\n    PODFILE_UNVERSIONED_POSTINSTALL: _renderUnversionedPostinstall(sdkVersion),\n    PODFILE_DETACHED_POSTINSTALL: _renderDetachedPostinstall(sdkVersion, false),\n    PODFILE_DETACHED_SERVICE_POSTINSTALL: _renderDetachedPostinstall(sdkVersion, true),\n    PODFILE_VERSIONED_RN_DEPENDENCIES: versionedDependencies,\n    PODFILE_VERSIONED_POSTINSTALLS: versionedPostinstalls,\n    PODFILE_TEST_TARGET: shellAppSdkVersion ? '' : _renderTestTarget(reactNativePath),\n    ...moreSubstitutions,\n  };\n  _validatePodfileSubstitutions(substitutions);\n\n  let result = templateString;\n  for (const key in substitutions) {\n    if (substitutions.hasOwnProperty(key)) {\n      const replacement = substitutions[key];\n      result = result.replace(new RegExp(`\\\\$\\\\{${key}\\\\}`, 'g'), replacement);\n    }\n  }\n\n  await fs.writeFile(pathToOutput, result);\n}\n\nexport { renderExpoKitPodspecAsync, renderPodfileAsync };\n"],"sourceRoot":"/@expo/xdl@59.0.19/src"}