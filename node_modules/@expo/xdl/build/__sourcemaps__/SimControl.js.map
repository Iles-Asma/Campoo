{"version":3,"sources":["SimControl.ts"],"names":["isSimulatorRunningAsync","zeroMeansNo","osascript","execAsync","trim","getDefaultSimulatorDeviceUDIDAsync","stdout","defaultDeviceUDID","e","getContainerPathAsync","udid","bundleIdentifier","xcrunAsync","deviceUDIDOrBooted","error","stderr","match","openURLAsync","options","simctlAsync","url","openBundleIdAsync","bootAsync","isSimulatorBootedAsync","getBootedSimulatorsAsync","simulatorDeviceInfo","listAsync","Object","values","devices","reduce","prev","runtime","concat","filter","device","state","find","bootedDevice","installAsync","dir","uninstallAsync","parseSimControlJSONResults","input","JSON","parse","message","Logger","global","type","query","result","info","keys","runtimeSuffix","split","pop","osType","osVersionComponents","osVersion","join","sims","windowName","name","listDevicesAsync","output","text","includes","lines","line","metadata","deviceType","push","shutdownAsync","updatePermissionsAsync","action","permission","setAppearanceAsync","theme","eraseAsync","eraseAllAsync","addMediaAsync","mediaPath","captureScreenAsync","captureType","outputFilePath","path","extname","deleteUnavailableAsync","command","args","xcrunWithLogging","Boolean","isSimulatorAppRunningAsync","openSimulatorAppAsync","killAllAsync","isLicenseOutOfDate","lower","toLowerCase","isXcrunInstalledAsync","XDLError","chalk","bold"],"mappings":"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","sourcesContent":["import * as osascript from '@expo/osascript';\nimport spawnAsync, { SpawnOptions, SpawnResult } from '@expo/spawn-async';\nimport chalk from 'chalk';\nimport path from 'path';\n\nimport Logger from './Logger';\nimport XDLError from './XDLError';\n\ntype DeviceState = 'Shutdown' | 'Booted';\n\nexport type SimulatorDevice = {\n  availabilityError: 'runtime profile not found';\n  /**\n   * '/Users/name/Library/Developer/CoreSimulator/Devices/00E55DC0-0364-49DF-9EC6-77BE587137D4/data'\n   */\n  dataPath: string;\n  /**\n   * '/Users/name/Library/Logs/CoreSimulator/00E55DC0-0364-49DF-9EC6-77BE587137D4'\n   */\n  logPath: string;\n  /**\n   * '00E55DC0-0364-49DF-9EC6-77BE587137D4'\n   */\n  udid: string;\n  /**\n   * com.apple.CoreSimulator.SimRuntime.tvOS-13-4\n   */\n  runtime: string;\n  isAvailable: boolean;\n  /**\n   * 'com.apple.CoreSimulator.SimDeviceType.Apple-TV-1080p'\n   */\n  deviceTypeIdentifier: string;\n  state: DeviceState;\n  /**\n   * 'Apple TV'\n   */\n  name: string;\n\n  osType: OSType;\n  /**\n   * '13.4'\n   */\n  osVersion: string;\n  /**\n   * 'iPhone 11 (13.6)'\n   */\n  windowName: string;\n};\n\nexport type XCTraceDevice = {\n  /**\n   * '00E55DC0-0364-49DF-9EC6-77BE587137D4'\n   */\n  udid: string;\n  /**\n   * 'Apple TV'\n   */\n  name: string;\n\n  deviceType: 'device' | 'catalyst';\n  /**\n   * '13.4'\n   */\n  osVersion: string;\n};\n\ntype OSType = 'iOS' | 'tvOS' | 'watchOS' | 'macOS';\n\ntype PermissionName =\n  | 'all'\n  | 'calendar'\n  | 'contacts-limited'\n  | 'contacts'\n  | 'location'\n  | 'location-always'\n  | 'photos-add'\n  | 'photos'\n  | 'media-library'\n  | 'microphone'\n  | 'motion'\n  | 'reminders'\n  | 'siri';\n\ntype SimulatorDeviceList = {\n  devices: {\n    [runtime: string]: SimulatorDevice[];\n  };\n};\n\nexport async function isSimulatorRunningAsync() {\n  try {\n    const zeroMeansNo = (\n      await osascript.execAsync(\n        'tell app \"System Events\" to count processes whose name is \"Simulator\"'\n      )\n    ).trim();\n    if (zeroMeansNo === '0') {\n      return false;\n    }\n  } catch {\n    return false;\n  }\n\n  return true;\n}\n\nexport async function getDefaultSimulatorDeviceUDIDAsync() {\n  try {\n    const { stdout: defaultDeviceUDID } = await spawnAsync('defaults', [\n      'read',\n      'com.apple.iphonesimulator',\n      'CurrentDeviceUDID',\n    ]);\n    return defaultDeviceUDID.trim();\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Returns the local path for the installed tar.app. Returns null when the app isn't installed.\n *\n * @param udid\n * @param bundleIdentifier\n */\nexport async function getContainerPathAsync(\n  udid: string,\n  bundleIdentifier: string\n): Promise<string | null> {\n  try {\n    const { stdout } = await xcrunAsync([\n      'simctl',\n      'get_app_container',\n      deviceUDIDOrBooted(udid),\n      bundleIdentifier,\n    ]);\n    return stdout.trim();\n  } catch (error) {\n    if (error.stderr?.match(/No such file or directory/)) {\n      return null;\n    }\n    throw error;\n  }\n}\n\nexport async function openURLAsync(options: { udid?: string; url: string }) {\n  return simctlAsync(['openurl', deviceUDIDOrBooted(options.udid), options.url]);\n}\n\nexport async function openBundleIdAsync(options: {\n  udid?: string;\n  bundleIdentifier: string;\n}): Promise<SpawnResult> {\n  return simctlAsync(['launch', deviceUDIDOrBooted(options.udid), options.bundleIdentifier]);\n}\n\n// This will only boot in headless mode if the Simulator app is not running.\nexport async function bootAsync({ udid }: { udid: string }): Promise<SimulatorDevice | null> {\n  try {\n    // Skip logging since this is likely to fail.\n    await xcrunAsync(['simctl', 'boot', udid]);\n  } catch (error) {\n    if (!error.stderr?.match(/Unable to boot device in current state: Booted/)) {\n      throw error;\n    }\n  }\n  return await isSimulatorBootedAsync({ udid });\n}\n\nexport async function getBootedSimulatorsAsync(): Promise<SimulatorDevice[]> {\n  const simulatorDeviceInfo = await listAsync('devices');\n  return Object.values(simulatorDeviceInfo.devices).reduce((prev, runtime) => {\n    return prev.concat(runtime.filter(device => device.state === 'Booted'));\n  }, []);\n}\n\nexport async function isSimulatorBootedAsync({\n  udid,\n}: {\n  udid?: string;\n}): Promise<SimulatorDevice | null> {\n  // Simulators can be booted even if the app isn't running :(\n  const devices = await getBootedSimulatorsAsync();\n  if (udid) {\n    return devices.find(bootedDevice => bootedDevice.udid === udid) ?? null;\n  } else {\n    return devices[0] ?? null;\n  }\n}\n\nexport async function installAsync(options: { udid: string; dir: string }): Promise<any> {\n  return simctlAsync(['install', deviceUDIDOrBooted(options.udid), options.dir]);\n}\nexport async function uninstallAsync(options: {\n  udid?: string;\n  bundleIdentifier: string;\n}): Promise<any> {\n  return simctlAsync(['uninstall', deviceUDIDOrBooted(options.udid), options.bundleIdentifier]);\n}\n\nfunction parseSimControlJSONResults(input: string): any {\n  try {\n    return JSON.parse(input);\n  } catch (error) {\n    // Nov 15, 2020: Observed this can happen when opening the simulator and the simulator prompts the user to update the XC command line tools.\n    // Unexpected token I in JSON at position 0\n    if (error.message.match('Unexpected token')) {\n      Logger.global.error(`Apple's simctl returned malformed JSON:\\n${input}`);\n    }\n    throw error;\n  }\n}\n\n// TODO: Compare with\n// const results = await SimControl.xcrunAsync(['instruments', '-s']);\nexport async function listAsync(\n  type: 'devices' | 'devicetypes' | 'runtimes' | 'pairs',\n  query?: string | 'available'\n): Promise<SimulatorDeviceList> {\n  const result = await simctlAsync(['list', type, '--json', query]);\n  const info = parseSimControlJSONResults(result.stdout) as SimulatorDeviceList;\n\n  for (const runtime of Object.keys(info.devices)) {\n    // Given a string like 'com.apple.CoreSimulator.SimRuntime.tvOS-13-4'\n    const runtimeSuffix = runtime.split('com.apple.CoreSimulator.SimRuntime.').pop()!;\n    // Create an array [tvOS, 13, 4]\n    const [osType, ...osVersionComponents] = runtimeSuffix.split('-');\n    // Join the end components [13, 4] -> '13.4'\n    const osVersion = osVersionComponents.join('.');\n    const sims = info.devices[runtime];\n    for (const device of sims) {\n      device.runtime = runtime;\n      device.osVersion = osVersion;\n      device.windowName = `${device.name} (${osVersion})`;\n      device.osType = osType as OSType;\n    }\n  }\n  return info;\n}\n\n/**\n * Get a list of all connected devices.\n */\nexport async function listDevicesAsync(): Promise<XCTraceDevice[]> {\n  const { output } = await xcrunAsync(['xctrace', 'list', 'devices']);\n\n  const text = output.join('');\n  const devices: XCTraceDevice[] = [];\n  if (!text.includes('== Simulators ==')) {\n    return [];\n  }\n\n  const lines = text.split('\\n');\n  for (const line of lines) {\n    if (line === '== Simulators ==') {\n      break;\n    }\n    const device = line.match(/(.*?) (\\(([0-9.]+)\\) )?\\(([0-9A-F-]+)\\)/i);\n    if (device) {\n      const [, name, , osVersion, udid] = device;\n      const metadata: XCTraceDevice = {\n        name,\n        udid,\n        osVersion: osVersion ?? '??',\n        deviceType: osVersion ? 'device' : 'catalyst',\n      };\n\n      devices.push(metadata);\n    }\n  }\n\n  return devices;\n}\n\nexport async function shutdownAsync(udid?: string) {\n  try {\n    return simctlAsync(['shutdown', deviceUDIDOrBooted(udid)]);\n  } catch (e) {\n    if (!e.message?.includes('No devices are booted.')) {\n      throw e;\n    }\n  }\n  return null;\n}\n\n// Some permission changes will terminate the application if running\nexport async function updatePermissionsAsync(\n  udid: string,\n  action: 'grant' | 'revoke' | 'reset',\n  permission: PermissionName,\n  bundleIdentifier?: string\n) {\n  return simctlAsync(['privacy', deviceUDIDOrBooted(udid), action, permission, bundleIdentifier]);\n}\n\nexport async function setAppearanceAsync(udid: string, theme: 'light' | 'dark') {\n  return simctlAsync(['ui', deviceUDIDOrBooted(udid), theme]);\n}\n\n// Cannot be invoked unless the simulator is `shutdown`\nexport async function eraseAsync(udid: string) {\n  return simctlAsync(['erase', deviceUDIDOrBooted(udid)]);\n}\n\nexport async function eraseAllAsync() {\n  return simctlAsync(['erase', 'all']);\n}\n\n// Add photos and videos to the simulator's gallery\nexport async function addMediaAsync(udid: string, mediaPath: string) {\n  return simctlAsync(['addmedia', deviceUDIDOrBooted(udid), mediaPath]);\n}\n\nexport async function captureScreenAsync(\n  udid: string,\n  captureType: 'screenshot' | 'recordVideo',\n  outputFilePath: string\n) {\n  return simctlAsync([\n    'io',\n    deviceUDIDOrBooted(udid),\n    captureType,\n    `—type=${path.extname(outputFilePath)}`,\n    outputFilePath,\n  ]);\n}\n\n// Clear all unused simulators\nexport async function deleteUnavailableAsync() {\n  return simctlAsync(['delete', 'unavailable']);\n}\n\nexport async function simctlAsync(\n  [command, ...args]: (string | undefined)[],\n  options?: SpawnOptions\n): Promise<SpawnResult> {\n  return xcrunWithLogging(\n    // @ts-ignore\n    ['simctl', command, ...args.filter(Boolean)],\n    options\n  );\n}\n\nfunction deviceUDIDOrBooted(udid?: string): string {\n  return udid ? udid : 'booted';\n}\n\n/**\n * I think the app can be open while no simulators are booted.\n */\nexport async function isSimulatorAppRunningAsync(): Promise<boolean> {\n  try {\n    const zeroMeansNo = (\n      await osascript.execAsync(\n        'tell app \"System Events\" to count processes whose name is \"Simulator\"'\n      )\n    ).trim();\n    if (zeroMeansNo === '0') {\n      return false;\n    }\n  } catch (error) {\n    if (error.message.includes('Application isn’t running')) {\n      return false;\n    }\n    throw error;\n  }\n\n  return true;\n}\n\nexport async function openSimulatorAppAsync({ udid }: { udid?: string }) {\n  const args = ['-a', 'Simulator'];\n  if (udid) {\n    // This has no effect if the app is already running.\n    args.push('--args', '-CurrentDeviceUDID', udid);\n  }\n  return await spawnAsync('open', args);\n}\n\nexport async function killAllAsync() {\n  return await spawnAsync('killAll', ['Simulator']);\n}\n\nexport function isLicenseOutOfDate(text: string) {\n  if (!text) {\n    return false;\n  }\n\n  const lower = text.toLowerCase();\n  return lower.includes('xcode') && lower.includes('license');\n}\n\nexport async function isXcrunInstalledAsync() {\n  try {\n    await spawnAsync('xcrun', ['--version']);\n    return true;\n  } catch (error) {\n    return false;\n  }\n}\n\nexport async function xcrunAsync(args: string[], options?: SpawnOptions) {\n  try {\n    return await spawnAsync('xcrun', args, options);\n  } catch (e) {\n    if (isLicenseOutOfDate(e.stdout) || isLicenseOutOfDate(e.stderr)) {\n      throw new XDLError(\n        'XCODE_LICENSE_NOT_ACCEPTED',\n        'Xcode license is not accepted. Please run `sudo xcodebuild -license`.'\n      );\n    } else if (e.stderr?.includes('not a developer tool or in PATH')) {\n      throw new XDLError(\n        'SIMCTL_NOT_AVAILABLE',\n        `You may need to run ${chalk.bold(\n          'sudo xcode-select -s /Applications/Xcode.app'\n        )} and try again.`\n      );\n    }\n    throw e;\n  }\n}\nexport async function xcrunWithLogging(\n  args: string[],\n  options?: SpawnOptions\n): Promise<SpawnResult> {\n  try {\n    return await xcrunAsync(args, options);\n  } catch (e) {\n    Logger.global.error(`Error running \\`xcrun ${args.join(' ')}\\`: ${e.stderr || e.message}`);\n    throw e;\n  }\n}\n"],"file":"../SimControl.js","sourceRoot":"/@expo/xdl@59.0.19/src"}